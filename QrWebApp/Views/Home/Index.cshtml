@{
    ViewData["Title"] = "Generatore QR Code";
}

<div class="container mt-4">
    <h1 class="mb-4">Genera un QR Code con Logo</h1>
    <form asp-action="GenerateQr" asp-controller="Home" method="post" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="link" class="form-label">Link da codificare</label>
            <input type="url" class="form-control" id="link" name="link" placeholder="https://..." required value="@ViewBag.Link">
        </div>
        <div class="mb-3">
            <label for="logo" class="form-label">Logo (opzionale)</label>
            <input type="file" class="form-control" id="logo" name="logo" accept="image/*">
        </div>
        <button type="submit" class="btn btn-primary">Genera QR Code</button>
    </form>
    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger mt-3">@ViewBag.Error</div>
    }
    @if (ViewBag.QrCode != null)
    {
        <div class="mt-4 text-center">
            <h4>QR Code generato:</h4>
            <img id="qrImage" src="@ViewBag.QrCode" alt="QR Code" class="img-thumbnail" style="max-width:300px;">
            <div class="mt-3">
                <a id="downloadBtn" href="@ViewBag.QrCode" download="qrcode.png" class="btn btn-success me-2">Scarica</a>
                <button class="btn btn-secondary me-2" onclick="saveQrToBrowser()">Salva nel browser</button>
                <a class="btn btn-info" href="/Home/Archivio">Recupera QR salvati</a>
            </div>
        </div>
    }
</div>
@section Scripts {
<script>
function saveQrToBrowser() {
    const qrImg = document.getElementById('qrImage');
    if (!qrImg) return;
    let saved = JSON.parse(localStorage.getItem('savedQrs') || '[]');
    saved.push({ img: qrImg.src, date: new Date().toLocaleString() });
    localStorage.setItem('savedQrs', JSON.stringify(saved));
    alert('QR Code salvato nel browser!');
}
</script>
}
