@{
    ViewData["Title"] = "Archivio QRCode salvati";
}

<div class="container mt-4">
    <h1 class="mb-4">Archivio QRCode salvati</h1>
    <div id="savedQrsList" class="mt-4"></div>
</div>

<div id="fullscreenView" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.9); z-index:1000; text-align:center;">
    <div style="position:absolute; top:20px; right:20px; color:white; font-size:30px; cursor:pointer;" onclick="closeFullscreen()">&times;</div>
    <img id="fullscreenImage" style="max-width:90%; max-height:90%; margin:auto; position:absolute; top:0; bottom:0; left:0; right:0;" src="" />
</div>

@section Scripts {
<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadSavedQRCodes();
    });

    function loadSavedQRCodes() {
        var savedQRs = JSON.parse(localStorage.getItem('savedQrs') || '[]');
        var container = document.getElementById('savedQrsList');
        if (savedQRs.length === 0) {
            container.innerHTML = '<div class="alert alert-info">Nessun QR code salvato.</div>';
            return;
        }
        var html = '<div class="row">';
        for (var i = 0; i < savedQRs.length; i++) {
            html += '<div class="col-md-4 mb-4">';
            html += '<div class="card">';
            html += '<div class="card-body text-center">';
            html += '<img src="' + savedQRs[i].img + '" class="img-fluid mb-2" style="max-height:200px; cursor:pointer;" onclick="showFullscreen(\'' + savedQRs[i].img + '\')">';
            html += '<p class="small text-muted">' + (savedQRs[i].date || '') + '</p>';
            html += '<div class="btn-group btn-group-sm w-100">';
            html += '<a href="' + savedQRs[i].img + '" download="qrcode-' + i + '.png" class="btn btn-success">Scarica</a>';
            html += '<button class="btn btn-danger" onclick="deleteQRCode(' + i + ')">Elimina</button>';
            html += '</div>';
            html += '</div>';
            html += '</div>';
            html += '</div>';
        }
        html += '</div>';
        container.innerHTML = html;
    }

    function deleteQRCode(index) {
        if (confirm('Sei sicuro di voler eliminare questo QR code?')) {
            var savedQRs = JSON.parse(localStorage.getItem('savedQrs') || '[]');
            savedQRs.splice(index, 1);
            localStorage.setItem('savedQrs', JSON.stringify(savedQRs));
            loadSavedQRCodes();
        }
    }

    function showFullscreen(imageSrc) {
        document.getElementById('fullscreenImage').src = imageSrc;
        document.getElementById('fullscreenView').style.display = 'block';
    }

    function closeFullscreen() {
        document.getElementById('fullscreenView').style.display = 'none';
        document.getElementById('fullscreenImage').src = '';
    }
</script>
}
